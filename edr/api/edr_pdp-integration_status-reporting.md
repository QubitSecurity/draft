## âœ… PLURA Agentê°€ ì œê³µí•´ì•¼ í•  "ìƒíƒœ ì •ë³´" ê°œìš”

### ğŸ“¦ ìƒíƒœ ì •ë³´ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ì¡°í™”ëœ ìš”ì•½ ë°ì´í„°(JSON í˜•íƒœ)ë¡œ ìœ ì§€í•©ë‹ˆë‹¤:

```json
{
  "agent_id": "win10-abcd-1234",
  "hostname": "DESKTOP-USER1",
  "os_version": "Windows 10 Pro 22H2",
  "status": {
    "malware_detected": false,
    "last_scan_time": "2025-05-13T16:50:00Z",
    "real_time_protection": true,
    "integrity_passed": true,
    "policy_violations": [],
    "last_status_change": "2025-05-13T16:50:00Z"
  }
}
```

---

## âœ… â€œë³€ê²½ë  ë•Œë§ˆë‹¤â€ íšŒì‹ í•˜ê¸° ìœ„í•œ ì „ëµ

### â‘  **ìƒíƒœ ìºì‹œ êµ¬ì¡° ìœ ì§€**

* AgentëŠ” ë©”ëª¨ë¦¬ ë˜ëŠ” ë¡œì»¬ íŒŒì¼ì— **ì´ì „ ìƒíƒœ ìŠ¤ëƒ…ìƒ·**ì„ ìœ ì§€
* ì£¼ê¸°ì ìœ¼ë¡œ í˜„ì¬ ìƒíƒœë¥¼ ì ê²€í•œ í›„, **ì´ì „ ìƒíƒœì™€ ë¹„êµ**

```python
if current_status != cached_status:
    send_to_pdp(current_status)
    cached_status = current_status
```

### â‘¡ **ìƒíƒœ ë³€ê²½ ê°ì§€ ê¸°ì¤€ ì˜ˆì‹œ**

| í•­ëª©         | ë³€ê²½ ì¡°ê±´                            |
| ---------- | -------------------------------- |
| ì•…ì„±ì½”ë“œ ê°ì§€ ì—¬ë¶€ | `false â†’ true` ë˜ëŠ” `true â†’ false` |
| ì •ì±… ìœ„ë°˜ ì—¬ë¶€   | ìœ„ë°˜ í•­ëª©ì´ ìƒˆë¡œ ë°œìƒí•˜ê±°ë‚˜ í•´ì œë¨              |
| ë¬´ê²°ì„± ê²€ì¦ ì‹¤íŒ¨  | íŒŒì¼ ìœ„ì¡°ë‚˜ ê¶Œí•œ ë³€ê²½ ë°œìƒ                  |
| ì‹¤ì‹œê°„ ë³´í˜¸ ì¤‘ì§€ë¨ | `real_time_protection: false` ë°œìƒ |
| ìŠ¤ìº” ì‹¤íŒ¨      | ìµœê·¼ ìŠ¤ìº” ì‹œë„ ì‹¤íŒ¨ ê¸°ë¡ ì¶”ê°€ë¨               |

---

## âœ… íšŒì‹  ë°©ì‹: ë‹¨ë°©í–¥ í‘¸ì‹œ or Pull API í˜¸í™˜

### âœ… A. **PDPê°€ ìˆ˜ì‹ í•˜ëŠ” API ì˜ˆì‹œ (Agent â†’ PDP)**

```http
POST /api/v1/status/update
Authorization: Bearer <token>
Content-Type: application/json

{
  "agent_id": "win10-abcd-1234",
  "timestamp": "2025-05-13T16:51:20Z",
  "status": {
    "malware_detected": true,
    "real_time_protection": false,
    "policy_violations": ["USB_BLOCK_DISABLED"],
    "integrity_passed": false
  },
  "signature": "HMAC-SHA256(...)"
}
```

## âœ… B. PDPê°€ Pull ë°©ì‹ìœ¼ë¡œ ìƒíƒœ ì¡°íšŒí•˜ëŠ” API ì˜ˆì‹œ

---

### ğŸ“Œ ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„

```
GET /api/v1/agents/{agent_id}/status
```

### ğŸ” ì¸ì¦ ë°©ì‹

* **MTLS** ë˜ëŠ” **Bearer Token** ì¸ì¦ í•„ìˆ˜
* HMAC ë˜ëŠ” JWT ì„œëª… ë°©ì‹ë„ ì„ íƒ ê°€ëŠ¥

---

### ğŸ“¥ ìš”ì²­ ì˜ˆ

```http
GET /api/v1/agents/win10-abcd-1234/status
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6...
Accept: application/json
```

---

### ğŸ“¤ ì‘ë‹µ ì˜ˆ (200 OK)

```json
{
  "agent_id": "win10-abcd-1234",
  "hostname": "DESKTOP-USER1",
  "last_reported_at": "2025-05-13T17:15:00Z",
  "status": {
    "malware_detected": false,
    "real_time_protection": true,
    "integrity_passed": true,
    "policy_violations": [],
    "last_scan_time": "2025-05-13T17:10:00Z"
  },
  "signature": "HMAC-SHA256(...)"
}
```

---

### ğŸ“„ ì˜¤ë¥˜ ì‘ë‹µ ì˜ˆ

#### 404 Not Found (Agent ë“±ë¡ ì•ˆë¨)

```json
{
  "error": "Agent not found",
  "agent_id": "win10-unknown-9999"
}
```

#### 403 Forbidden (ì¸ì¦ ì‹¤íŒ¨)

```json
{
  "error": "Unauthorized request"
}
```

---

## âœ… ì¶”ê°€ ê³ ë ¤ì‚¬í•­

| í•­ëª©                        | ì„¤ëª…                                    |
| ------------------------- | ------------------------------------- |
| ì‘ë‹µì— `last_reported_at` í¬í•¨ | PDPê°€ ë°ì´í„° ì‹ ì„ ë„(ì˜ˆ: 10ë¶„ ì´ìƒ ê²½ê³¼ ì—¬ë¶€) íŒë‹¨ ê°€ëŠ¥   |
| ìœ„ë³€ì¡° ë°©ì§€                    | ì‘ë‹µ ë³¸ë¬¸ì€ HMAC ë˜ëŠ” JWT ì„œëª… í¬í•¨í•˜ì—¬ í™•ì¸ ê°€ëŠ¥      |
| ìºì‹± ì „ëµ                     | PDPëŠ” ì¼ì • ê¸°ê°„ ë‚´ ì¡°íšŒ ê²°ê³¼ ìºì‹œ ê°€ëŠ¥ (ex. 5ë¶„ê°„ ìœ íš¨) |

---

## ğŸ§© ì˜ˆì‹œ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤

1. ì‚¬ìš©ìê°€ ë‚´ë¶€ ì‹œìŠ¤í…œì— ì ‘ê·¼ ìš”ì²­
2. PEPê°€ PDPì— Agent ID ì „ë‹¬
3. PDPëŠ” PLURA Agent ìƒíƒœ ì¡°íšŒ API í˜¸ì¶œ
4. ìƒíƒœ ì •ë³´ ê¸°ë°˜ìœ¼ë¡œ ì ‘ê·¼ í—ˆìš©/ì°¨ë‹¨ ê²°ì •

---

## ğŸ§© ë³´ì™„ ì‚¬í•­

| í•­ëª©              | ì„¤ëª…                                |
| --------------- | --------------------------------- |
| API ì „ì†¡ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ | ë¡œì»¬ íì— ì €ì¥í•˜ì—¬ ì¬ì „ì†¡ ë¡œì§ ìœ ì§€ (ë‹¨ì ˆ ëŒ€ë¹„)      |
| ìƒíƒœ ë³€ì¡° ë°©ì§€        | HMAC ë˜ëŠ” JWTë¡œ ì„œëª… í›„ ì „ì†¡              |
| ì´ë²¤íŠ¸ ë¡œê¹…          | Agentê°€ ë³€ê²½ ìƒíƒœ ì „ì†¡ ì‹œ ë¡œì»¬ ë¡œê·¸ ë‚¨ê¸°ê¸° (ê°ì‚¬ìš©) |

---

## âœ… ìš”ì•½

| êµ¬ì„± ìš”ì†Œ  | êµ¬í˜„ ë°©ì‹                            |
| ------ | -------------------------------- |
| ìƒíƒœ ìœ ì§€  | Agent ë‚´ ìƒíƒœ ìºì‹œì™€ í˜„ì¬ ìƒíƒœ ë¹„êµ          |
| ë³€ê²½ ê°ì§€  | ì•…ì„±ì½”ë“œ íƒì§€, ë¬´ê²°ì„± ìœ„ë°˜, ì‹¤ì‹œê°„ ë³´í˜¸ ë¹„í™œì„± ë“± ê¸°ì¤€ |
| ì „ì†¡ ë°©ì‹  | ë³€ê²½ ì‹œì—ë§Œ PDP APIë¡œ ë‹¨ë°©í–¥ í‘¸ì‹œ           |
| ë°ì´í„° í˜•ì‹ | êµ¬ì¡°í™”ëœ JSON + ì„œëª… í¬í•¨                |
| ë³´ì•ˆ     | MTLS + HMAC/JWT ì„œëª…ìœ¼ë¡œ ìœ„ì¡° ë°©ì§€       |

---

ì¶”ê°€ í™•ì¥ ë¶€ë¶„:

* C++ ë˜ëŠ” C# ê¸°ë°˜ ìƒíƒœ ë¹„êµ ë¡œì§ ìƒ˜í”Œ
* API ì „ì†¡ ì‹¤íŒ¨ ì‹œ í ì²˜ë¦¬ ë¡œì§
* ìƒíƒœ ë³€í™” ì „ì†¡ì„ ìœ„í•œ ê²½ëŸ‰ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì„¤ê³„

