# 필상 시스템 — Day 11 데이터 거버넌스 & 컴플라이언스

1. **날짜**

* 2025-08-20

2. **목표**

* **데이터 수명주기(수집→보존→파기)**·**암호화/KMS**·**감사/접근통제** 표준 확정
* KR/JP 리전의 **데이터 주권(APPI/ISMS-P 대응)** 원칙과 **법적 보존/증거보전** 절차 정립

---

3. **내용**

### A. 데이터 분류 & 카탈로그

* **등급**: P0(민감 PII/인증정보), P1(운영 로그·사건 증거), P2(메타데이터), P3(퍼블릭)
* **카탈로그**: `data_catalog.yaml`(소유자, 보존기간, 암호화, 접근정책, 마스킹 규칙)
* **PII 최소화**: IP는 `/24` 버킷(`src_ip_trunc`), 이메일은 `sha256(email)` 저장 원칙

### B. 저장소 정책(리전 분리)

* **KR/JP 물리 분리**, 크로스리전 쿼리 금지(메타-카탈로그만 중앙 공유)
* **검색 인덱스(Solr)**: PII 마스킹 필드만 인덱싱, 원본은 **Object Storage(S3/MinIO)**에 암호화 저장
* **DB(Postgres)**: 테넌트별 스키마 분리 + RLS 활성화

### C. 암호화 & KMS

* **전송 구간**: 전 서비스 **mTLS**, 외부는 TLS1.2+
* **저장 시**:

  * 객체/스냅샷: **AES-256-GCM**, **서버측 암호화(KMS 키)**
  * DB 컬럼레벨: P0 필드 **Envelope Encryption**(KMS → 데이터키)
* **키 관리**: 리전별 KMS 키(마스터 키 분리), **회전 90일**, 파기 시 **주체·근거 기록**

### D. 접근통제 & 승인

* **정책 엔진**: RBAC + ABAC(`tenant_id`, `region`, `purpose`)
* **목적 제한(Purpose Binding)**: 조회 요청에 `purpose` 필수(운영/감사/수사 등)
* **승인 흐름**: P0/P1 데이터는 **2인 승인**(요청→승인→서명 URL 발급 10분 만료)

### E. 보존·파기·법적 보존(Legal Hold)

* **보존 기본**:

  * 인덱스 로그/이벤트: 90일, 사건 인덱스: 1년, 원본 증거: 3년
* **법적 보존**: 사건/수사 요청 시 `legal_hold=true` → 수명주기 중단, 키 파기 보류
* **파기**: 정책 만료 시 **폐기 작업 배치**(객체 삭제 + 키 폐기) → 보고서 자동 생성

### F. 감사(감사 인덱스 별도)

* **무결성**: 모든 감사 레코드 **해시 체인**(`prev_hash`) + 일 1회 루트 해시 고정
* **기록 항목**: `actor, tenant, scopes, purpose, dataset, action, ip, ts, trace_id, evidence_uri`
* **감사 쿼리**: 콘솔에서 기간/행위자/목적 필터, **내보내기 시 서명 해시 포함**

### G. 데이터 유출/반출(Egress) 통제

* **네트워크**: 기본 거부, **목적지 화이트리스트**(TI 공급자, 메일/SMS 게이트웨이 등)
* **애플리케이션**: 다운로드는 **서명 URL + 워터마크 + 만료** / 화면 캡처시 PII 블러
* **DLP 룰**: P0 패턴(주민번호·여권·카드 BIN 등) 감지 시 **경보 + 차단/승인흐름 전환**

### H. 외부 TI/3rd-Party 연동

* **데이터 최소 전송**: 해시/요약치만 전송, **원본 미전송**
* **계약/컴플라이언스**: 처리위탁 목록·SCC(표준계약조항) 레지스터 유지, 지역 밖 저장 금지

### I. 운영 산출물

* `policies/data_governance.md`(본 문서 반영)
* `kms/keys.kr.tf`, `kms/keys.jp.tf`(IaC)
* `jobs/retention.yaml`(보존/폐기 크론), `audits/schema.json`(감사 스키마)

---

4. **예시 설명 (수사 협조·증거 패키지 발급 절차)**

1) **Incident #01J…**에 대해 관할기관 공문 접수 → 콘솔에서 사건 **Legal Hold** 설정
2) 분석가는 **‘증거 패키지 만들기’** 클릭 → 자동 생성 항목:

   * 인덱스 요약(JSON), 원본 로그 객체 URI, 관련 TI 스냅샷, 룰/릴리스 변경 이력
   * **무결성 체인**(루트 해시), 생성자/승인자 디지털 서명
3) **2인 승인** 완료 시 **서명 URL**(10분 만료) 발급, 목적은 `investigation`으로 기록
4) 만료 후 자동 폐기, 감사 인덱스에 **다운로드 이벤트**와 해시가 연결 저장
5) 사건 종료·보존기간 만료 시 **키 회전/폐기**와 함께 객체 삭제 → **폐기 보고서** 생성(감사 열람 가능)

> 결과: 리전·등급·목적에 따른 **최소권한·최소데이터 원칙**이 일관되게 적용되고, 수사/감사 상황에서도 **무결성·추적성**을 보장하며, 만료 시 **확정적 파기**가 자동으로 집행됩니다.
