# 필상 시스템 — Day 37 운영 접근 통제(JIT 액세스 · Bastion · Break-Glass)

1. **날짜**

* 2025-09-30

2. **목표**

* **운영자/개발자 접근**을 **JIT(Just-In-Time)** 승인·시간제·목적구속으로 표준화
* **Bastion·세션기록·권한상승(JEA)**·**Break-Glass** 절차 확정 → **무단접근 0건**, **감사 100%**

---

3. **내용**

### A. 접근 계층 & 역할

* **User**: 콘솔·API 일반 사용(테넌트 RBAC/ABAC)
* **Operator**: 읽기+헬스 점검(로그/지표 조회만)
* **SRE/Admin**: 제한적 쓰기(배포/플래그), **JIT 필수**
* **Security/CSIRT**: 증거 조회·법적 보존 토글(2인 승인)
* **Break-Glass**: 재해·치명 장애 시 일시 최고권한(강력한 사후감사)

### B. JIT 워크플로우(표준)

1. **요청**: 포털에서 *목적(purpose)*·*범위(scope)*·*기간(duration)* 선택
2. **평가**: OPA 정책(업무시간/리스크/변경창) + 디바이스 포스처(SSO·MFA·시큐어 브라우저/VPN)
3. **승인**: L1(팀리드) 또는 L2(보안) 2인 승인 조건
4. **발급**: **단명(≤60분)** 크리덴셜(SSO/OIDC/STS), **권한상승(JEA)** 프로파일 적용
5. **접속**: **Bastion**을 통해서만(SSH/RDP/K8s/kubectl/DB 프록시), **세션 녹화**
6. **종료**: 만료·조기 회수 → 토큰 폐기, 세션 정리, 감사레코드 고정

### C. Bastion 아키텍처

* **접속 경로 단일화**: SSH(Strong Auth)+K8s API 프록시+DB 프록시(계정 공유 금지)
* **mTLS & CA**: 접속 시점 **ephemeral cert** 발급(서명자·목적 포함)
* **세션 기록**: 터미널/CLI/파일 업·다운로드 이벤트, **keystroke 해시**, 화면녹화(RDP)
* **명령 가드**: `denylist/allowlist` + 위험 명령 **사전승인/프롬프트 경고**
* **전송 규제**: 업/다운로드는 **서명 URL**만, 외부망 SCP/SFTP 차단

### D. 권한상승(JEA · JIT-RBAC)

* **JEA(Just Enough Admin)**: 역할별 **허용 명령 집합**(kubectl subset, psql subset)
* **리소스 스코프**: `env`, `region`, `namespace`, `tenant` 단위 최소권한
* **시간제 비밀**: KMS **STS 15–60분** 토큰, 사용 후 즉시 폐기(로테이션 90일)

### E. Break-Glass(비상 접근)

* **트리거**: T0/T1 대규모 장애·보안사고
* **조건**: 2인 승인(경영 포함) + **타임락 15분 해제** + 범위/만료 강제(≤30분)
* **방어선**: 데이터 내보내기·키 파기·규제 필드는 **여전히 금지**(OPA 정책)
* **사후**: 24h 내 **RCA + 세션 재생** 리뷰, 키 폐기/교체, 변경 되돌리기

### F. 감사·컴플라이언스

* **감사 인덱스**: `who, why(purpose), what(resource/action), when, how(device/posture), trace_id, session_uri, prev_hash`
* **무결성**: 모든 세션 메타는 **해시체인** + 일 1회 루트 해시 고정
* **보관**: 일반 1년, 고위험/수사 관련 3년(리전 내 WORM)

### G. 모니터링·SLO

* SLI: `jit_grant_latency_p95 ≤ 60s`, `session_record_gap=0`, `unauthorized=0`
* 알람: 승인 없는 관리자 액션·Bastion 우회 시 **즉시 ALERT** + 계정 잠금

### H. API/툴(발췌)

* `POST /v1/jit/access { purpose, scope:{env,region,ns}, role, duration }`
* `POST /v1/jit/approve { request_id }` / `POST /v1/jit/revoke { grant_id }`
* `GET /v1/bastion/sessions?range=…` — 세션 목록/재생 링크
* `POST /v1/breakglass { reason, scope, duration }` — 비상 요청(승인 2인 필수)

### I. 운영 체크리스트

* [ ] 전 관리자 계정 **JIT 강제**, 상시(Admin) 토큰 금지
* [ ] Bastion 외 **직접 접근 차단**(보안그룹/방화벽)
* [ ] 세션 녹화 **무누락**(gap 감시), 키/토큰 **단명·회수 시험 월 1회**
* [ ] Break-Glass **분기 리허설**, 타임락·승인·사후검토 자동화
* [ ] 목적구속 필수 입력, **다운로드는 서명 URL**만 유지

---

4. **예시 설명 (KR-prod Solr 긴급 장애—JIT & Break-Glass 38분 복구)**

1) **T1** 알람: 검색 샤드 리더 불안정 → SRE가 **JIT 요청**(scope: `prod/kr/solr`, 45분).
2) 2인 승인 후 **ephemeral cert** 발급(1분), Bastion 통해 `kubectl/solrctl` **JEA 프로파일**로 접속.
3) 리더 교체·캐시 조정으로 미복구 → **Break-Glass 30분** 승인(경영 포함, 타임락 해제).
4) 고위험 명령 실행(샤드 재배치) 후 정상화, 전체 **38분** 소요.
5) 세션·명령·다운로드 이벤트가 **해시체인**으로 고정, 24h 내 **RCA/키 교체/되돌리기** 완료.

> 결과: **JIT·Bastion·JEA·Break-Glass** 결합으로 필요한 순간에만 최소권한을 **안전하게 부여**, 모든 행위는 **증거화**되어 규제·감사를 만족하면서 **복구 속도**를 유지합니다.
